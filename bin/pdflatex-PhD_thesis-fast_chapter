#!/bin/bash

redo_bib=0
redo_fmf=0
for arg in "$@"; do
    case "$arg" in
        --bib)
            redo_bib=1
            shift
            ;;
        --fmf)
            redo_fmf=1
            shift
            ;;
    esac
done

pdffilename=$(basename ~+)

if [[ $pdffilename == *appendix* ]] || [[ $pdffilename == *annexe* ]]
then
    generator=appendix
else
    generator=chapter
fi

if [ -e LT-These-${generator}_generator_with_toc.bcf ] && [[ $redo_bib == 0 ]]
then
   echo 'Not reprocessing bib.'
else
    pdflatex -draftmode -interaction=batchmode -halt-on-error $lt_PhD_thesis_dir/tex/LT-These-${generator}_generator_with_toc
    biber LT-These-${generator}_generator_with_toc
fi

if [[ $redo_fmf == 0 ]]
then
   echo 'Not reprocessing fmf.'
else
    mpost_all
fi

pdflatex -interaction=batchmode -halt-on-error $lt_PhD_thesis_dir/tex/LT-These-${generator}_generator_with_toc

mv LT-These-${generator}_generator_with_toc.log $pdffilename.log
mv LT-These-${generator}_generator_with_toc.pdf $pdffilename.pdf

check_LaTeX_logs
